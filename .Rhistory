data <- read.csv("data/eurusd1.csv",header=F)
data <- read.csv("data/eurusd1.csv",header=F,stringsAsFactors=F)
colnames(data) <- c("date","time","open","high","low","close","volume")
View(data)
plot(data,type="l")
plot(data$close,type="l")
kpredict <- function(data,lens=seq(10,30),k=10) {
N <- length(data)
pds <- lapply(lens,function(len) {
series <- data[(N-len+1):N]
corr.list <- lapply(1:(N-len),function(i) {
list(length=len,index=i,cor=cor(data[i:(i+len-1)],series),predict=data[i+len])
})
corr.df <- do.call("rbind",corr.list)
corrs <- corr.df[with(corr.df,order(abs(cor),decreasing=T)),][1:k,]
predict.sd <- sd(exp(corrs$cor)*corrs$predict/sum(exp(corrs$cor)))
list(length=len,predict.sd=predict.sd)
})
pds.df <- do.call("rbind",pds)
result <- pds.df[with(pds.df,order(predict.sd)),][1]
result
}
kpredict(data[1:2000])
kpredict(data[1:2000])
kpredict(data[1:2000])
source('D:/Workspaces/kNN/src/classic-knn.R')
debugSource('D:/Workspaces/kNN/src/classic-knn.R')
kpredict(data[1:2000])
kpredict(data[1:2000,"close"])
source('D:/Workspaces/kNN/src/classic-knn.R')
kpredict(data[1:2000,"close"])
kpredict(data[1:2000,"close"])
kpredict(data[1:2000,"close"])
kpredict(data[1:2000,"close"])
d <- data[1:2000,"close"]
head(d)
N <- length(d)
len <- 10
series <- d[(N-len+1):N]
list(length=len,index=1,cor=cor(data[1:(1+len-1)],series),predict=data[1+len])
list(length=len,index=1,cor=cor(d[1:(1+len-1)],series),predict=d[1+len])
list(length=len,index=2,cor=cor(d[2:(2+len-1)],series),predict=d[2+len])
list(length=len,index=N-len,cor=cor(d[(N-len):(N-len+len-1)],series),predict=d[N-len+len])
corr.list <- lapply(1:(N-len),function(i) {
list(length=len,index=i,cor=cor(data[i:(i+len-1)],series),predict=data[i+len])
})
corr.list <- lapply(1:(N-len),function(i) {
list(length=len,index=i,cor=cor(d[i:(i+len-1)],series),predict=d[i+len])
})
corr.list[[1]]
corr.df <- do.call("rbind",corr.list)
View(corr.df)
corrs <- corr.df[with(corr.df,order(abs(cor),decreasing=T)),][1:k,]
corrs <- corr.df[with(corr.df,order(abs(cor),decreasing=T)),]
View(corr.df)
corrs <- corr.df[with(corr.df,order(abs(cor),decreasing=T)),]
corrs <- corr.df[with(corr.df,order(cor,decreasing=T)),]
corr.df$cor
View(corr.df)
colnames(corr.df)
corr.df <- data.frame(do.call("rbind",corr.list))
corrs <- corr.df[with(corr.df,order(abs(cor),decreasing=T)),][1:k,]
View(corr.df)
corrs <- corr.df[with(corr.df,order(cor,decreasing=T)),][1:k,]
head(corrs)
head(corr.df)
corrs <- corr.df[order(corr.df$cor,decreasing=T),]
corr.df$cor
kpredict <- function(data,lens=seq(10,30),k=10) {
N <- length(data)
predict.df.list <- lapply(lens,function(len) {
series <- data[(N-len+1):N]
corr.df.list <- lapply(1:(N-len),function(i) {
data.frame(length=len,index=i,cor=cor(data[i:(i+len-1)],series),predict=data[i+len])
})
corr.df <- data.frame(do.call("rbind",corr.df.list))
corr <- corr.df[with(corr.df,order(abs(cor),decreasing=T)),][1:k,]
predict.sd <- sd(exp(corr$cor)*corr$predict/sum(exp(corr$cor)))
data.frame(length=len,predict.sd=predict.sd)
})
predict.df<- do.call("rbind",predict.df.list)
result <- predict.df[with(predict.df,order(predict.sd)),][1]
result
}
kpredict(data[1:2000,"close"])
